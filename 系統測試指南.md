# 學生異動管理系統測試指南

## 🎯 測試目標

驗證修復後的學生異動管理系統功能是否正常運作，特別是備份恢復機制，確保不再出現 `backupStudentFromTeacherBook is not defined` 錯誤。

## 📋 測試步驟

### 1. 基礎功能驗證測試

#### Google Apps Script 控制台測試

**步驟1：開啟 Google Apps Script 編輯器**
1. 進入你的 Google Apps Script 專案
2. 選擇任一 .gs 檔案（建議選擇 TestBackupRestore.gs）

**步驟2：執行基礎驗證**
```javascript
// 在 Apps Script 編輯器中執行以下函數
quickValidateAllFunctions()  // 驗證所有函數定義
```

**預期結果：**
```
✅ backupStudentFromMasterList - 已定義
✅ backupStudentFromTeacherBook - 已定義
✅ restoreStudentToMasterList - 已定義
✅ restoreStudentToTeacherBook - 已定義
✅ restoreContactRecords - 已定義
✅ getOrCreateBackupFolder - 已定義
✅ updateRowInSheet - 已定義
✅ calculateProgressForTeacherBook - 已定義
✅ calculateSystemStats - 已定義
📊 函數驗證完成 - 總計：9，已定義：9，缺失：0
```

### 2. 修復效果驗證

**步驟1：執行修復驗證**
```javascript
verifyFunctionFix()  // 驗證修復效果
```

**預期結果：**
```
✅ 函數定義檢查 - 通過
✅ 備份流程檢查 - 通過  
✅ 原始錯誤修復檢查 - 通過
📊 修復驗證完成 - 通過：3/3
```

### 3. 備份恢復功能測試

**步驟1：執行完整備份測試**
```javascript
testBackupRestoreFunctionality()  // 完整備份恢復測試
```

**步驟2：執行備份流程測試**
```javascript
testBackupWorkflow()  // 備份流程測試
```

**預期結果：**
```
✅ 測試 backupStudentFromMasterList - 通過
✅ 測試 backupStudentFromTeacherBook - 通過
✅ 測試 restoreStudentToMasterList - 通過
✅ 測試 restoreStudentToTeacherBook - 通過
✅ 測試 restoreContactRecords - 通過
✅ 測試 getOrCreateBackupFolder - 通過
✅ 測試 updateRowInSheet - 通過
✅ 測試 calculateProgressForTeacherBook - 通過
✅ 測試 calculateSystemStats - 通過
📊 測試完成 - 總計：9，通過：9，失敗：0
```

### 4. 系統完整性測試

**步驟1：執行快速測試**
```javascript
runQuickTest()  // 快速系統測試
```

**步驟2：執行完整測試套件**
```javascript
runAllStudentChangeTests()  // 運行所有異動管理測試
```

**預期結果：**
```
⚡ 快速測試完成 - 通過：5/5
🧪 所有測試完成 - 總計：30+，通過：30+，失敗：0
```

## 🖥️ 實際功能測試

### 1. Google Sheets 選單測試

**步驟1：開啟老師記錄簿**
1. 進入任一老師的電聯記錄簿
2. 查看頂部選單是否包含「🔄 學生異動管理」

**步驟2：測試各項功能**
- 點選「📤 學生轉學/移出」
- 點選「🔄 學生轉班」
- 點選「✏️ 學生資料更新」
- 點選「📋 查看異動記錄」

**驗證重點：**
- 功能是否正常啟動
- 是否出現錯誤訊息
- 對話框是否正確顯示

### 2. Web Dashboard 測試

**步驟1：開啟 Web Dashboard**
1. 在老師記錄簿中點選「🌐 開啟 Web Dashboard」
2. 找到「🔄 學生異動管理」面板

**步驟2：測試搜尋功能**
1. 在搜尋框中輸入學生ID或姓名
2. 點擊「搜尋學生」按鈕
3. 查看搜尋結果是否正確顯示

**步驟3：測試異動操作**
1. 選擇一個學生記錄
2. 測試「轉學」、「轉班」、「更新資料」按鈕
3. 填寫相關資訊並提交

## 🔍 測試關鍵點

### 成功指標

#### 1. 技術指標
- ✅ 所有測試函數執行無錯誤
- ✅ 9個新增函數全部正確定義
- ✅ 備份恢復流程完整性驗證通過
- ✅ 不再出現 "backupStudentFromTeacherBook is not defined" 錯誤

#### 2. 功能指標
- ✅ 學生轉學操作成功完成
- ✅ 學生轉班操作成功完成
- ✅ 學生資料更新操作成功完成
- ✅ 異動記錄正確生成
- ✅ 備份檔案正確創建

#### 3. 用戶體驗指標
- ✅ 選單功能正常運作
- ✅ Web Dashboard 介面響應正常
- ✅ 錯誤訊息清晰易懂
- ✅ 操作流程順暢

### 測試重點場景

#### 場景1：學生轉學測試
1. 選擇一個測試學生
2. 執行轉學操作
3. 驗證：
   - 備份是否成功創建
   - 學生是否從所有記錄中移除
   - 異動記錄是否正確生成

#### 場景2：學生轉班測試
1. 選擇一個測試學生
2. 執行轉班操作（指定新老師）
3. 驗證：
   - 學生是否從原老師記錄中移除
   - 學生是否添加到新老師記錄中
   - 學生總表是否更新

#### 場景3：資料更新測試
1. 選擇一個測試學生
2. 更新學生資訊（如姓名、班級）
3. 驗證：
   - 所有相關檔案是否同步更新
   - 資料一致性是否保持

## 🛠️ 問題排除

### 如果測試失敗

#### 1. 檢查執行日誌
- 在 Apps Script 編輯器中查看「執行日誌」
- 記錄詳細的錯誤訊息
- 確認是在哪個步驟失敗

#### 2. 權限檢查
- 確認 Google Apps Script 有足夠權限
- 檢查 Google Drive 和 Google Sheets 存取權限
- 重新授權如有需要

#### 3. 資料完整性檢查
- 確認學生總表存在
- 確認老師記錄簿結構正確
- 驗證必要的工作表是否存在

#### 4. 程式碼部署檢查
```bash
# 確認最新程式碼已部署
clasp status
clasp push
```

### 常見問題解決

#### 問題1：函數未定義錯誤
**解決方案：**
1. 執行 `clasp push` 重新部署
2. 重新整理 Apps Script 編輯器
3. 重新執行測試

#### 問題2：權限不足錯誤
**解決方案：**
1. 點擊「授權」按鈕
2. 允許所有必要權限
3. 重新執行測試

#### 問題3：資料不存在錯誤
**解決方案：**
1. 檢查學生總表是否存在
2. 確認老師記錄簿格式正確
3. 使用測試資料進行測試

## 📊 測試報告模板

### 測試執行記錄

**測試日期：** [填寫日期]
**測試人員：** [填寫姓名]
**測試版本：** [填寫版本]

#### 基礎功能驗證
- [ ] quickValidateAllFunctions() - 通過/失敗
- [ ] verifyFunctionFix() - 通過/失敗
- [ ] testBackupRestoreFunctionality() - 通過/失敗

#### 實際功能測試
- [ ] 學生轉學操作 - 通過/失敗
- [ ] 學生轉班操作 - 通過/失敗
- [ ] 學生資料更新 - 通過/失敗

#### 介面測試
- [ ] Google Sheets 選單 - 通過/失敗
- [ ] Web Dashboard 功能 - 通過/失敗

#### 總結
- **通過測試：** ___/___
- **失敗測試：** ___/___
- **整體狀態：** 通過/失敗

**備註：**
[記錄任何問題或建議]

---

## 🎯 測試成功確認

當您完成所有測試並看到以下結果時，表示系統修復成功：

1. ✅ **所有 9 個函數都已正確定義**
2. ✅ **備份恢復流程驗證通過**
3. ✅ **學生異動操作成功完成**
4. ✅ **不再出現 "backupStudentFromTeacherBook is not defined" 錯誤**
5. ✅ **異動記錄正確生成和備份**

**恭喜！您的學生異動管理系統已完全修復並可正常使用！**

---

*最後更新：2025-07-18*  
*版本：v1.0*